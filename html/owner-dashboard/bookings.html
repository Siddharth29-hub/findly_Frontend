<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bookings | Findly Owner</title>
  <link rel="stylesheet" href="../../css/owner-dashboard/bookings.css" />
</head>
<body>

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo">
      <img src="../../images/findly-full-logo.png" alt="Findly Logo" class="findly-logo" />
    </div>
    <nav class="menu">
      <a href="owner-dashboard.html">Dashboard</a>
      <a href="services.html">Services</a>
      <a href="crm.html">CRM</a>
      <a href="payments.html">Payments</a>
      <a href="bookings.html" class="active">Bookings</a>
      <a href="reviews.html">Reviews</a>
      <a href="analytics.html">Analytics</a>
      <a href="system.html">System</a>
      <a href="profile.html">Profile</a>
    </nav>
  </aside>

  <!-- Main Content -->
  <section class="main-content">

    <!-- Topbar -->
    <div class="topbar">
      <h1>Bookings Management</h1>
      <button class="new-btn">+ Add New Booking</button>
    </div>

    <!-- Overview Cards -->
    <div class="booking-overview">
      <div class="booking-card total"><h2>128</h2><p>Total Bookings</p></div>
      <div class="booking-card pending"><h2>15</h2><p>Pending Requests</p></div>
      <div class="booking-card approved"><h2>103</h2><p>Approved</p></div>
      <div class="booking-card cancelled"><h2>10</h2><p>Cancelled</p></div>
    </div>

    <!-- Search + Filters -->
    <div class="search-filter">
      <input type="text" placeholder="ðŸ” Search by student or service..." />
      <select>
        <option value="">Filter by Status</option>
        <option>Pending</option>
        <option>Approved</option>
        <option>Cancelled</option>
      </select>
      <input type="date" />
      <button class="filter-btn">Apply</button>
    </div>

    <!-- Bookings Table -->
    <div class="booking-table-container">
      <table class="booking-table">
        <thead>
          <tr>
            <th>Booking ID</th>
            <th>Student Name</th>
            <th>Service</th>
            <th>Date</th>
            <th>Duration</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>#B001</td>
            <td>Rahul Mehta</td>
            <td>Hostel Room</td>
            <td>2025-10-10</td>
            <td>6 Months</td>
            <td><span class="status pending">Pending</span></td>
            <td>
              <button class="view-btn">View Details</button>
              <button class="approve-btn">Approve</button>
              <button class="cancel-btn">Cancel</button>
            </td>
          </tr>
          <tr>
            <td>#B002</td>
            <td>Simran Kaur</td>
            <td>Mess Subscription</td>
            <td>2025-10-08</td>
            <td>1 Month</td>
            <td><span class="status approved">Approved</span></td>
            <td>
              <button class="view-btn">View Details</button>
              <button class="approve-btn">Approve</button>
              <button class="cancel-btn">Cancel</button>
            </td>
          </tr>
          <tr>
            <td>#B003</td>
            <td>Priya Sharma</td>
            <td>Coaching Class</td>
            <td>2025-10-06</td>
            <td>3 Months</td>
            <td><span class="status cancelled">Cancelled</span></td>
            <td>
              <button class="view-btn">View Details</button>
              <button class="approve-btn">Approve</button>
              <button class="cancel-btn">Cancel</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- Booking Details Modal -->
  <div id="bookingModal" class="modal">
    <div class="modal-content booking-modal">
      <span id="closeModal" class="close-btn">&times;</span>

      <div class="modal-header">
        <img src="../../images/findly-full-logo.png" alt="Findly Logo" class="findly-full-logo" />
        <h2>Booking Details</h2>
      </div>

      <div class="modal-body">
        <div class="modal-row"><p><strong>Booking ID:</strong></p><span id="b-id"></span></div>
        <div class="modal-row"><p><strong>Student Name:</strong></p><span id="b-name"></span></div>
        <div class="modal-row"><p><strong>Service:</strong></p><span id="b-service"></span></div>
        <div class="modal-row"><p><strong>Date:</strong></p><span id="b-date"></span></div>
        <div class="modal-row"><p><strong>Duration:</strong></p><span id="b-duration"></span></div>
        <div class="modal-row"><p><strong>Status:</strong></p><span id="b-status" class="status-tag"></span></div>
        <div class="modal-row">
          <p><strong>Remarks:</strong></p>
          <textarea id="b-remarks" placeholder="Add remarks here..."></textarea>
        </div>
      </div>

      <div class="modal-footer">
        <button class="save-btn">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast-container"></div>

  <!-- Script -->
  <script>
    const toastContainer = document.querySelector('.toast-container');

    function showToast(message) {
      const toast = document.createElement('div');
      toast.classList.add('toast', 'show');
      toast.textContent = message;
      toastContainer.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    // Overview card references
    const overview = {
      total: document.querySelector('.booking-card.total h2'),
      pending: document.querySelector('.booking-card.pending h2'),
      approved: document.querySelector('.booking-card.approved h2'),
      cancelled: document.querySelector('.booking-card.cancelled h2')
    };

    // Count recalculation
    function updateCounts() {
      let pending = 0, approved = 0, cancelled = 0, total = 0;
      document.querySelectorAll('.booking-table tbody tr').forEach(row => {
        const status = row.querySelector('.status').textContent.trim().toLowerCase();
        if (status === 'pending') pending++;
        else if (status === 'approved') approved++;
        else if (status === 'cancelled') cancelled++;
        total++;
      });
      overview.pending.textContent = pending;
      overview.approved.textContent = approved;
      overview.cancelled.textContent = cancelled;
      overview.total.textContent = total;
      Object.values(overview).forEach(h => {
        h.classList.add('pulse');
        setTimeout(() => h.classList.remove('pulse'), 500);
      });
    }

    // Approve / Cancel Actions
    document.querySelectorAll('.approve-btn').forEach(btn => {
      btn.addEventListener('click', e => {
        const row = e.target.closest('tr');
        const status = row.querySelector('.status');
        if (status.textContent === 'Approved') return showToast('âœ… Already Approved');
        status.textContent = 'Approved';
        status.className = 'status approved';
        showToast('âœ… Booking Approved');
        updateCounts();
      });
    });

    document.querySelectorAll('.cancel-btn').forEach(btn => {
      btn.addEventListener('click', e => {
        const row = e.target.closest('tr');
        const status = row.querySelector('.status');
        if (status.textContent === 'Cancelled') return showToast('âš  Already Cancelled');
        status.textContent = 'Cancelled';
        status.className = 'status cancelled';
        showToast('âŒ Booking Cancelled');
        updateCounts();
      });
    });

    // Modal Logic
    const modal = document.getElementById('bookingModal');
    const closeModal = document.getElementById('closeModal');
    const saveBtn = document.querySelector('.save-btn');

    document.querySelectorAll('.view-btn').forEach(btn => {
      btn.addEventListener('click', e => {
        const row = e.target.closest('tr').children;
        document.getElementById('b-id').textContent = row[0].textContent;
        document.getElementById('b-name').textContent = row[1].textContent;
        document.getElementById('b-service').textContent = row[2].textContent;
        document.getElementById('b-date').textContent = row[3].textContent;
        document.getElementById('b-duration').textContent = row[4].textContent;

        const statusText = row[5].textContent.trim().toLowerCase();
        const statusTag = document.getElementById('b-status');
        statusTag.textContent = row[5].textContent;
        statusTag.className = `status-tag ${statusText}`;

        modal.style.display = 'flex';
      });
    });

    closeModal.onclick = () => modal.style.display = 'none';
    window.onclick = e => { if (e.target === modal) modal.style.display = 'none'; };

    saveBtn.addEventListener('click', () => {
      showToast('ðŸ’¾ Booking remarks saved successfully!');
      modal.style.display = 'none';
    });

    updateCounts();
  </script>

</body>
</html>
